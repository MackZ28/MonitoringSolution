# MonitoringSolution

## Описание проекта

1. Приложение запускается в 3 контейнерах(backend(ASP.NET CORE, .NET 8), frontend(React, Typescript, Material-UI) и database(Postgres 15)).

2. На Бэкенде реализован swagger, где можно интерактивно протестировать запросы и посмотреть структуру ожидаемых и возвращаемых данных.

3. На стороне клиента(React) выводится таблица значений, обновляющихся в реальном времени каждые 5 секунд. В таблице указаны столбцы: 
   SensorID - идентификатор датчика, 
   Min - минимальное значение датчика, 
   Max - максимальне значение датчика, 
   Avarage - усредненное значение по датчику(пересчитывается), 
   Value - текущее значение с датчика, 
   Status - статус текущего значения с датчика,
      * OK - значение в диапазоне [15; 70]
      * WARNING - (5; 15) или (70; 90)
      * ERROR - < 5 или > 90
   Присутствует кнопка "Обновить сейчас".

4. Эмулятор сигналов в бэкенде запускается как фоновая задача(сервис) и отправляет данные в сервис обработки данных. 

5. На стороне Бэкенда обращение к БД происходит через Dapper, для более простого маппинга значений в объекты. 

6. Структура БД(2 таблицы): 
   * таблица sensor_data - служит для хранения исторических данных с датчиков. 
   * таблица sensor_state - служит для хранения агрегированных данных с датчиков, для более быстрого и удобного получения данных.
   Таблица sensor_state обновляется при получении каждого нового значения.

## Запуск проекта

### 1. Клонируем репозиторий


```bash
git clone https://github.com/MackZ28/MonitoringSolution.git
cd MonitoringSolution
```

## Запуск в контейнерах(с использованием Docker Compose)

1. Необходимо чтобы на машине был установлен Docker(Docker Desktop, Compose)
2. Запустить проект из коря проекта(где находится `docker-compose.yml`)

   ```bash
    docker-compose up --build
   ```

3. После успешного запуска должны работать 3 адреса: 
    - Backend: http://localhost:5000
    - Swagger backend: http://localhost:5000/swagger
    - Frontend: http://localhost:3000

4. Остановить контейнер: 
    ```bash
   docker-compose down
   ```

---

## Ручной запуск backend (без контейнеров)
Если необходимо запустить бэкенд без контейнера сперва нужно будет поднять БД, для ручной инициализации бд можно использовать скрипт:
```bash
  psql -U postgres -f database/init.sql
  ```
  предварительно создав объект базы данных и настроив строку подключения к БД в файле `backend/appsettings.json`.

  Далее: 
1. Установить зависимости(если нужно): 
  ```bash
   dotnet restore
   ```
2. Запустить backend:
    ```bash
   dotnet run
   ```
4. Swagger будет доступна после запуска на [http://localhost:5000/swagger](http://localhost:5000/swagger).

---

## Ручной запуск frontend (без контейнеров)

1. Перейдите в папку frontend:

   ```bash
   cd frontend
   ```

2. Установите зависимости:

   ```bash
   npm install
   ```

3. Запустите приложение:

   ```bash
   npm start
   ```
   Откроется http://localhost:3000/

4. При необходимости настройте переменные окружения (например, файл `.env`, если требуется явно задать адрес API):

   ```ini
   REACT_APP_API_URL=http://localhost:5000
   ```
